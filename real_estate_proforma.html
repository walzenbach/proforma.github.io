<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Development Pro-Forma</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .content {
            padding: 25px 20px;
        }

        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section h3::before {
            content: "üìä";
            margin-right: 10px;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input, select {
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-size: 0.9rem;
            padding: 8px 15px;
        }

        .calc-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
            width: 100%;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .results {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .results h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .results-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .result-item {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .lot-section {
            background: #fff5e6;
            border-left-color: #f39c12;
            position: relative;
        }

        .lot-section h3::before {
            content: "üè†";
        }

        .lot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .lot-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 700;
        }

        .add-lot-btn {
            margin-bottom: 20px;
        }

        .expense-revenue {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (min-width: 600px) {
            .expense-revenue {
                grid-template-columns: 1fr 1fr;
            }
        }

        .expense-item, .revenue-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.95rem;
        }

        .expense-item:last-child, .revenue-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1rem;
            border-top: 2px solid #3498db;
            padding-top: 15px;
        }

        .loan-calc {
            background: #e8f4fd;
            border-left-color: #3498db;
        }

        .loan-calc h3::before {
            content: "üè¶";
        }

        .global-calc {
            background: #f0f8ff;
            border-left-color: #8e44ad;
        }

        .global-calc h3::before {
            content: "üåç";
        }

        .hidden {
            display: none;
        }

        .show {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .lot-counter {
            background: #3498db;
            color: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .summary-table {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
        }

        .summary-table table {
            width: 100%;
            color: white;
            border-collapse: collapse;
        }

        .summary-table th,
        .summary-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .summary-table th {
            font-weight: 600;
            opacity: 0.9;
        }

        .summary-table tr:last-child td {
            border-bottom: none;
            font-weight: 600;
        }

        @media (max-width: 600px) {
            .summary-table {
                overflow-x: auto;
            }
            
            .summary-table table {
                min-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Real Estate Development Pro-Forma</h1>
            <p>Analyze multiple lots and calculate comprehensive deal metrics</p>
        </div>

        <div class="content">
            <div class="alert">
                <strong>üìù Instructions:</strong> Fill in the loan details and global settings, then add multiple lots to calculate your comprehensive deal metrics. All calculations update automatically.
            </div>

            <div class="section loan-calc">
                <h3>Loan Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="loanAmount">Total Loan Amount ($) *</label>
                        <input type="number" id="loanAmount" value="1664000" step="1000">
                    </div>
                    <div class="form-group">
                        <label for="downPaymentPct">Down Payment (%) *</label>
                        <input type="number" id="downPaymentPct" value="20" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="interestRate">Interest Rate (%) *</label>
                        <input type="number" id="interestRate" value="8.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="originationFee">Origination Fee (%) *</label>
                        <input type="number" id="originationFee" value="0.75" step="0.01">
                    </div>
                </div>
            </div>

            <div class="section global-calc">
                <h3>Global Settings</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="acquisitionCost">Total Acquisition Cost ($) *</label>
                        <input type="number" id="acquisitionCost" value="600000" step="1000">
                    </div>
                    <div class="form-group">
                        <label for="closingCosts">Closing Costs (%) *</label>
                        <input type="number" id="closingCosts" value="7.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="incrementalCosts">Total Incremental Costs ($) *</label>
                        <input type="number" id="incrementalCosts" value="450000" step="1000">
                    </div>
                    <div class="form-group">
                        <label for="investmentPeriod">Investment Exit Period (months) *</label>
                        <input type="number" id="investmentPeriod" value="14" step="1">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="lot-header">
                    <h3>Property Lots <span class="lot-counter" id="lotCounter">0 Lots</span></h3>
                    <button class="btn btn-success add-lot-btn" onclick="addLot()">
                        ‚ûï Add Lot
                    </button>
                </div>
                <div id="lotsContainer">
                    <!-- Lots will be added here dynamically -->
                </div>
            </div>

            <button class="calc-btn" onclick="calculateProForma()">
                üßÆ Calculate Pro-Forma
            </button>

            <div id="results" class="results hidden">
                <h3>üìà Comprehensive Financial Analysis</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-value" id="projectedNetIncome">$0</div>
                        <div class="result-label">Total Net Income</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="projectedIRR">0%</div>
                        <div class="result-label">Projected IRR</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="projectedROI">0%</div>
                        <div class="result-label">Projected ROI</div>
                    </div>
                </div>

                <div class="summary-table">
                    <h4>üìã Lot Summary</h4>
                    <table id="lotSummaryTable">
                        <thead>
                            <tr>
                                <th>Lot</th>
                                <th>Units</th>
                                <th>Sq Ft</th>
                                <th>Build Cost</th>
                                <th>Sales Revenue</th>
                                <th>Net Profit</th>
                            </tr>
                        </thead>
                        <tbody id="lotSummaryBody">
                        </tbody>
                    </table>
                </div>

                <div class="expense-revenue">
                    <div>
                        <h4>üí∞ Total Deal Expenses</h4>
                        <div class="expense-item"><span>Acquisition + Fees:</span><span id="acquisitionFees">$0</span></div>
                        <div class="expense-item"><span>Total Build Costs:</span><span id="totalBuildCosts">$0</span></div>
                        <div class="expense-item"><span>Incremental Costs:</span><span id="incrementalCostsDisplay">$0</span></div>
                        <div class="expense-item"><span>Interest & Origination:</span><span id="interestExpense">$0</span></div>
                        <div class="expense-item"><span>Total Expenses:</span><span id="totalExpenses">$0</span></div>
                    </div>
                    <div>
                        <h4>üíµ Total Deal Revenue</h4>
                        <div class="revenue-item"><span>Total Sales Price:</span><span id="totalSalesPrice">$0</span></div>
                        <div class="revenue-item"><span>Closing Costs:</span><span id="projectedClosingCosts">$0</span></div>
                        <div class="revenue-item"><span>Down Payment:</span><span id="downPaymentAmount">$0</span></div>
                        <div class="revenue-item"><span>Net Revenue:</span><span id="netRevenue">$0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lotCount = 0;
        let lots = [];

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatPercent(percent) {
            return percent.toFixed(2) + '%';
        }

        function addLot() {
            lotCount++;
            const lotId = `lot${lotCount}`;
            
            const lotSection = document.createElement('div');
            lotSection.className = 'lot-section section';
            lotSection.id = lotId;
            lotSection.innerHTML = `
                <div class="lot-header">
                    <h3 class="lot-title">Lot ${lotCount}</h3>
                    <button class="btn btn-danger" onclick="removeLot('${lotId}')">
                        üóëÔ∏è Remove
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="${lotId}_address">Address *</label>
                        <input type="text" id="${lotId}_address" value="Nashville, TN" data-lot="${lotCount}">
                    </div>
                    <div class="form-group">
                        <label for="${lotId}_numberOfUnits">Number of Units *</label>
                        <input type="number" id="${lotId}_numberOfUnits" value="1" step="1" data-lot="${lotCount}">
                    </div>
                    <div class="form-group">
                        <label for="${lotId}_projectedSF">Projected Square Feet *</label>
                        <input type="number" id="${lotId}_projectedSF" value="1850" step="100" data-lot="${lotCount}">
                    </div>
                    <div class="form-group">
                        <label for="${lotId}_buildCostPerFoot">Build Cost Per Sq Ft ($) *</label>
                        <input type="number" id="${lotId}_buildCostPerFoot" value="200" step="10" data-lot="${lotCount}">
                    </div>
                    <div class="form-group">
                        <label for="${lotId}_salesPricePerFoot">Sales Price Per Sq Ft ($) *</label>
                        <input type="number" id="${lotId}_salesPricePerFoot" value="380" step="10" data-lot="${lotCount}">
                    </div>
                    <div class="form-group">
                        <label for="${lotId}_contractorFee">Contractor Fee ($)</label>
                        <input type="number" id="${lotId}_contractorFee" value="0" step="1000" data-lot="${lotCount}">
                    </div>
                </div>
            `;

            document.getElementById('lotsContainer').appendChild(lotSection);
            updateLotCounter();
            attachLotEventListeners(lotId);
        }

        function removeLot(lotId) {
            const lotElement = document.getElementById(lotId);
            if (lotElement) {
                lotElement.remove();
                updateLotCounter();
                calculateProForma();
            }
        }

        function updateLotCounter() {
            const lotElements = document.querySelectorAll('.lot-section');
            const count = lotElements.length;
            document.getElementById('lotCounter').textContent = `${count} Lot${count !== 1 ? 's' : ''}`;
        }

        function attachLotEventListeners(lotId) {
            const inputs = document.querySelectorAll(`#${lotId} input`);
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(this.calcTimeout);
                    this.calcTimeout = setTimeout(calculateProForma, 500);
                });
            });
        }

        function getLotData() {
            const lotElements = document.querySelectorAll('.lot-section');
            const lotData = [];

            lotElements.forEach((lotElement, index) => {
                const lotId = lotElement.id;
                const lot = {
                    id: lotId,
                    number: index + 1,
                    address: document.getElementById(`${lotId}_address`).value || '',
                    numberOfUnits: parseFloat(document.getElementById(`${lotId}_numberOfUnits`).value) || 0,
                    projectedSF: parseFloat(document.getElementById(`${lotId}_projectedSF`).value) || 0,
                    buildCostPerFoot: parseFloat(document.getElementById(`${lotId}_buildCostPerFoot`).value) || 0,
                    salesPricePerFoot: parseFloat(document.getElementById(`${lotId}_salesPricePerFoot`).value) || 0,
                    contractorFee: parseFloat(document.getElementById(`${lotId}_contractorFee`).value) || 0
                };

                // Calculate lot-specific metrics
                lot.buildCost = lot.projectedSF * lot.buildCostPerFoot + lot.contractorFee;
                lot.salesPrice = lot.projectedSF * lot.salesPricePerFoot;
                lot.totalSalesPrice = lot.salesPrice * lot.numberOfUnits;
                lot.totalBuildCost = lot.buildCost * lot.numberOfUnits;

                lotData.push(lot);
            });

            return lotData;
        }

        function calculateProForma() {
            const lotData = getLotData();
            
            if (lotData.length === 0) {
                document.getElementById('results').classList.add('hidden');
                return;
            }

            // Get global input values
            const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
            const downPaymentPct = parseFloat(document.getElementById('downPaymentPct').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const originationFee = parseFloat(document.getElementById('originationFee').value) || 0;
            const acquisitionCost = parseFloat(document.getElementById('acquisitionCost').value) || 0;
            const closingCostsPct = parseFloat(document.getElementById('closingCosts').value) || 0;
            const incrementalCosts = parseFloat(document.getElementById('incrementalCosts').value) || 0;
            const investmentPeriod = parseFloat(document.getElementById('investmentPeriod').value) || 12;

            // Calculate loan details
            const downPaymentAmount = loanAmount * (downPaymentPct / 100);
            const originationFeeAmount = loanAmount * (originationFee / 100);

            // Calculate totals from all lots
            let totalBuildCosts = 0;
            let totalSalesPrice = 0;
            let totalUnits = 0;
            let totalSF = 0;

            lotData.forEach(lot => {
                totalBuildCosts += lot.totalBuildCost;
                totalSalesPrice += lot.totalSalesPrice;
                totalUnits += lot.numberOfUnits;
                totalSF += lot.projectedSF * lot.numberOfUnits;
            });

            // Calculate interest expense (simplified calculation)
            const monthlyRate = interestRate / 100 / 12;
            const avgBalance = loanAmount * 0.75; // Assume 75% average utilization
            const interestExpense = avgBalance * monthlyRate * investmentPeriod + originationFeeAmount;

            // Calculate total expenses
            const totalExpenses = acquisitionCost + totalBuildCosts + incrementalCosts + interestExpense;

            // Calculate closing costs on sale
            const projectedClosingCosts = totalSalesPrice * (closingCostsPct / 100);

            // Calculate net revenue and profit
            const netRevenue = totalSalesPrice - projectedClosingCosts;
            const projectedNetIncome = netRevenue - totalExpenses;

            // Calculate ROI and IRR (simplified)
            const totalInvestment = downPaymentAmount + (totalExpenses - loanAmount);
            const roi = totalInvestment > 0 ? (projectedNetIncome / totalInvestment) * 100 : 0;
            
            // Simplified IRR calculation (monthly)
            const monthlyReturn = totalExpenses > 0 ? Math.pow((netRevenue / totalExpenses), (12 / investmentPeriod)) - 1 : 0;
            const irr = monthlyReturn * 12 * 100;

            // Update main results display
            document.getElementById('projectedNetIncome').textContent = formatCurrency(projectedNetIncome);
            document.getElementById('projectedIRR').textContent = formatPercent(irr);
            document.getElementById('projectedROI').textContent = formatPercent(roi);

            // Update expenses
            document.getElementById('acquisitionFees').textContent = formatCurrency(acquisitionCost);
            document.getElementById('totalBuildCosts').textContent = formatCurrency(totalBuildCosts);
            document.getElementById('incrementalCostsDisplay').textContent = formatCurrency(incrementalCosts);
            document.getElementById('interestExpense').textContent = formatCurrency(interestExpense);
            document.getElementById('totalExpenses').textContent = formatCurrency(totalExpenses);

            // Update revenue
            document.getElementById('totalSalesPrice').textContent = formatCurrency(totalSalesPrice);
            document.getElementById('projectedClosingCosts').textContent = formatCurrency(projectedClosingCosts);
            document.getElementById('downPaymentAmount').textContent = formatCurrency(downPaymentAmount);
            document.getElementById('netRevenue').textContent = formatCurrency(netRevenue);

            // Update lot summary table
            updateLotSummaryTable(lotData, closingCostsPct);

            // Show results
            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.remove('hidden');
            resultsDiv.classList.add('show');
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function updateLotSummaryTable(lotData, closingCostsPct) {
            const tbody = document.getElementById('lotSummaryBody');
            tbody.innerHTML = '';

            let totalBuildCost = 0;
            let totalSalesRevenue = 0;
            let totalNetProfit = 0;

            lotData.forEach(lot => {
                const closingCosts = lot.totalSalesPrice * (closingCostsPct / 100);
                const netSalesRevenue = lot.totalSalesPrice - closingCosts;
                const netProfit = netSalesRevenue - lot.totalBuildCost;

                totalBuildCost += lot.totalBuildCost;
                totalSalesRevenue += netSalesRevenue;
                totalNetProfit += netProfit;

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>Lot ${lot.number}</td>
                    <td>${lot.numberOfUnits}</td>
                    <td>${lot.projectedSF * lot.numberOfUnits}</td>
                    <td>${formatCurrency(lot.totalBuildCost)}</td>
                    <td>${formatCurrency(netSalesRevenue)}</td>
                    <td>${formatCurrency(netProfit)}</td>
                `;
            });

            // Add totals row
            const totalRow = tbody.insertRow();
            totalRow.innerHTML = `
                <td><strong>TOTALS</strong></td>
                <td><strong>${lotData.reduce((sum, lot) => sum + lot.numberOfUnits, 0)}</strong></td>
                <td><strong>${lotData.reduce((sum, lot) => sum + (lot.projectedSF * lot.numberOfUnits), 0)}</strong></td>
                <td><strong>${formatCurrency(totalBuildCost)}</strong></td>
                <td><strong>${formatCurrency(totalSalesRevenue)}</strong></td>
                <td><strong>${formatCurrency(totalNetProfit)}</strong></td>
            `;
        }

        // Initialize with one lot
        document.addEventListener('DOMContentLoaded', function() {
            addLot(); // Add initial lot

            // Attach event listeners to global inputs
            const globalInputs = document.querySelectorAll('#loanAmount, #downPaymentPct, #interestRate, #originationFee, #acquisitionCost, #closingCosts, #incrementalCosts, #investmentPeriod');
            globalInputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(this.calcTimeout);
                    this.calcTimeout = setTimeout(calculateProForma, 500);
                });
            });

            // Initial calculation after a short delay
            setTimeout(calculateProForma, 100);
        });
    </script>
</body>
</html>